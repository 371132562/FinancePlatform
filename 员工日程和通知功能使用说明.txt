========================================
员工日程和通知功能使用说明
========================================

一、功能概述
----------
本系统提供员工日程管理功能，支持日程创建、状态更新、回复讨论等操作，并通过通知系统确保相关人员及时了解日程变化。

二、角色说明
----------
系统包含以下三种角色：

1. 系统管理员（内置角色，不可修改）
   - 拥有所有权限，可以访问所有功能模块
   - 可以查看和删除所有日程
   - 不接收业务通知，专注于系统管理
   - 不支持新增相同权限的角色

2. 公司管理者（内置角色，不可修改）
   - 拥有所有权限，可以访问所有功能模块
   - 可以创建日程并分配给员工
   - 可以查看和删除所有日程
   - 接收业务通知
   - 不支持新增相同权限的角色

3. 员工（内置角色，可删除和编辑）
   - 仅拥有员工日程管理和通知消息权限
   - 可以创建日程并选择其他人员协同
   - 只能查看与自己相关的日程
   - 接收业务通知
   - 与用户自建角色无区别，仅为了方便直接使用

说明：系统管理员和公司管理者具有相同的最高权限，是所有角色的最高级别。用户无法通过创建角色获得相同权限，系统会阻止创建此类角色。

三、日程管理功能
----------

3.1 创建日程
创建新日程时需要填写以下信息：
- 日程标题：必填项，用于标识日程内容
- 日程描述：必填项，详细描述日程内容
- 执行人员：必填项，可选择多个执行人员协同处理

注意事项：
- 创建者可以选择自己和他人作为执行人员
- 创建者自己不需要给自己发通知
- 系统管理员和公司管理者不会被分配任务，执行人员只能选择系统管理员和公司管理者之外的角色用户

3.2 日程状态
日程有以下五种状态：
1. 待完成：初始状态，表示日程已创建但未开始
2. 进行中：表示正在处理中的日程
3. 有风险：表示可能无法按时完成的日程
4. 已完成：表示已经完成且达到预期目标的日程
5. 已停止：表示因故终止或取消的日程

3.3 修改日程状态
- 可以在日程列表页面直接修改状态
- 也可以进入日程详情页修改状态
- 修改状态需要二次确认

3.4 状态更新自动回复
当更新日程状态时，系统会自动生成一条回复记录用于追踪状态变更历史：
- 回复用户为当前操作者
- 回复内容显示状态变更情况
- 例如："状态已从'待完成'更新为'进行中'"

3.5 添加回复
在日程详情页可以添加回复，用于讨论和沟通：
- 回复输入框位于日程讨论区域
- 输入内容后点击发送按钮即可添加回复
- 回复按时间顺序显示

3.6 删除日程
- 仅系统管理员和公司管理者可以删除日程
- 删除操作需要二次确认
- 删除日程后，相关通知也会被删除
- 删除操作不可恢复

3.7 数据权限
- 系统管理员和公司管理者：可以查看所有日程
- 员工：只能查看与自己相关的日程（创建者或执行人员）
- 后端根据角色和用户ID自动过滤数据

四、通知功能
----------

4.1 通知类型
系统在以下情况下会生成通知：

1. 新日程任务
   - 触发时机：创建新日程时
   - 接收人员：所有执行人员（排除创建者和系统管理员）

2. 日程状态更新
   - 触发时机：更新日程状态时
   - 接收人员：所有执行人员（排除更新者和系统管理员）
   - 特殊说明：如果创建者不在执行人员列表中且不是操作本人，会给创建者发送通知

3. 日程有新回复
   - 触发时机：为日程添加回复时
   - 接收人员：所有执行人员（排除回复者和系统管理员）
   - 特殊说明：如果创建者不在执行人员列表中且不是操作本人，会给创建者发送通知

4.2 通知内容
不同操作的通知标题和内容如下：

- 新日程：标题"新的日程任务"，内容"您有新的日程任务：{日程标题}"
- 状态更新：标题"日程状态更新"，内容"日程'{日程标题}'状态已更新"
- 新回复：标题"日程有新回复"，内容"日程'{日程标题}'有新的回复"

4.3 通知查看
通知可以通过以下方式查看：

1. 右上角通知下拉
   - 显示最近3条未读通知
   - 显示未读通知数量
   - 点击通知可跳转到对应日程详情页
   - 点击通知后自动标记为已读
   - 提供"查看全部"按钮跳转到通知列表

2. 通知列表页面
   - 显示所有通知记录
   - 可以标记单条通知为已读
   - 可以批量标记所有通知为已读
   - 可以删除通知
   - 支持按标题和内容搜索

4.4 通知跳转
- 点击通知标题可以跳转到对应的日程详情页
- 跳转后自动将该通知标记为已读
- 未读通知数量会自动更新

五、使用流程示例
------------

5.1 创建并分配日程
1. 系统管理员或公司管理者登录系统
2. 进入"员工日程"菜单，点击"日程列表"
3. 点击"新建日程"按钮
4. 填写日程标题和描述
5. 选择执行人员（可选择多个）
6. 点击"创建"按钮
7. 系统自动为所有执行人员创建通知

5.2 查看并处理日程
1. 员工登录系统
2. 查看右上角通知数量
3. 点击通知查看新分配的日程
4. 进入日程详情页了解详细内容
5. 更新日程状态（例如：从"待完成"更新为"进行中"）
6. 根据需要添加回复说明进展情况
7. 系统自动为相关人员创建通知

5.3 监控和反馈
1. 管理者或创建者查看日程列表
2. 进入感兴趣的日程详情页
3. 查看状态变更历史（自动回复记录）
4. 查看执行人员的回复和反馈
5. 根据需要添加回复指导或询问情况
6. 最终将日程状态更新为"已完成"或"已停止"

六、注意事项
----------

6.1 权限说明
- 系统管理员不接收业务通知，避免干扰系统管理工作
- 员工只能操作与自己相关的日程
- 只有系统管理员和公司管理者可以删除日程

6.2 数据隔离
- 后端根据用户角色和关联关系自动过滤数据
- 员工看不到与自己无关的日程
- 管理者和系统管理员可以看到所有日程

6.3 通知规则
- 操作者不会收到自己操作产生的通知
- 系统管理员不接收任何业务通知
- 创建者通知：当更新状态或新增回复时，如果创建者不在执行人员列表中且不是操作者本人，系统会给创建者发送通知
  （举例：A创建了日程并分配给B和C执行，当B更新状态时，A会收到通知；但如果A自己更新状态，则不会收到通知）

6.4 状态管理
- 日程一旦创建，标题和描述不可修改
- 只能通过状态更新和添加回复来追踪进度
- 如果需要大幅修改，建议删除后重新创建

========================================
文档版本：v1.0
最后更新：2025年10月
========================================
